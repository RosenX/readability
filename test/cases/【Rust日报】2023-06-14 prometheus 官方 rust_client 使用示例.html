<html><head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <title>
ã€Rustæ—¥æŠ¥ã€‘2023-06-14 prometheus å®˜æ–¹ rust_client ä½¿ç”¨ç¤ºä¾‹ - Rustè¯­è¨€ä¸­æ–‡ç¤¾åŒº
</title>
    <!--    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>-->
    <link rel="stylesheet" type="text/css" href="/css/base.css">
</head>
<body>
<div id="header">
    <div class="header">
    <div class="logo left">
        <a href="/">
		<img class="left" src="/img/rust-logo.svg">
		<div class="logo-title left">Rustè¯­è¨€ä¸­æ–‡ç¤¾åŒº</div>
		<div style="clear:both;"></div>
        </a>
        <div style="clear:both;"></div>
    </div>

    <div class="signpart right">
        <a href="/search">Search</a> &nbsp;
        <a href="/rss">RSS</a> &nbsp;
        <a href="/account">å¸æˆ·</a>
	</div>
	<div style="clear:both;"></div>
</div>

</div>
<div id="content">
    
<!--<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.12.0/build/styles/default.min.css">-->
<link rel="stylesheet" href="/css/gruvbox-light.css">
<script src="https://hm.baidu.com/hm.js?1fd834970f3ad2bab2cb57d4aa2b2e5a"></script><script src="/js/jquery.min.js"></script>
<script src="/js/highlight.pack.js"></script>

<div class="body-content article_detail detail">
    <div class="article_detail_head">
	
	    <a href="/section?id=f4703117-7e6b-4caf-aa22-a3ad3db6898f" class="return">&lt; è¿”å›ç‰ˆå—</a>
	
	<div class="title">
	    <h2><a href="/article?id=5f8142ce-06c4-4a69-a876-6b66c0370b5f">ã€Rustæ—¥æŠ¥ã€‘2023-06-14 prometheus å®˜æ–¹ rust_client ä½¿ç”¨ç¤ºä¾‹</a></h2>
	</div>
	<p class="vice-title">
	    <a href="/blog_with_author?author_id=759351a5-ec46-491d-b3bf-9aad92168610">EAHITechnology</a>

	    å‘è¡¨äº <span class="article_created_time">2023-06-15 21:55</span>

	    
	</p>
	<p>
	    
	    <small>Tagsï¼šrust, æ—¥æŠ¥</small>
	    
	</p>
    </div>

    <div class="detail-body ">
	<h4>prometheus å®˜æ–¹ rust_client ä½¿ç”¨ç¤ºä¾‹</h4>
<p>promethes æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ç›‘æ§ç³»ç»Ÿä¹‹ä¸€ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ rust_client çš„ğŸŒ°:</p>
<pre><code class="hljs rust">use prometheus_client::encoding::{EncodeLabelSet, EncodeLabelValue};
use prometheus_client::encoding::text::encode;
use prometheus_client::metrics::counter::{Atomic, Counter};
use prometheus_client::metrics::family::Family;
use prometheus_client::registry::Registry;
use std::io::Write;

// åˆ›å»ºä¸€ä¸ªæŒ‡æ ‡ registryã€‚
// æ³¨æ„å°–æ‹¬å·ä»¥ç¡®ä¿å¯¹æ³›å‹ç±»å‹å‚æ•°ä½¿ç”¨é»˜è®¤å€¼ï¼ˆåŠ¨æ€è°ƒåº¦è£…ç®±æŒ‡æ ‡ï¼‰ã€‚
let mut registry = &lt;Registry&gt;::default();

#[derive(Clone, Debug, Hash, PartialEq, Eq, EncodeLabelValue)]
enum Method {
  GET,
  PUT,
};

// å®šä¹‰ä¸€ä¸ªè¡¨ç¤ºæŒ‡æ ‡æ ‡ç­¾é›†çš„ç±»å‹ï¼Œå³é”®å€¼å¯¹ã€‚
// æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ `(String, String)` æ¥è¡¨ç¤ºæ ‡ç­¾é›†ï¼Œè€Œä¸æ˜¯ä¸‹é¢çš„è‡ªå®šä¹‰ç±»å‹ã€‚

#[derive(Clone, Debug, Hash, PartialEq, Eq, EncodeLabelSet)]
struct Labels {
  method: Method,
  path: String,
};

// ä½¿ç”¨ä¸Šè¿°è‡ªå®šä¹‰æ ‡ç­¾ç±»å‹åˆ›å»ºç¤ºä¾‹è®¡æ•°å™¨æŒ‡æ ‡ç³»åˆ—ï¼Œè¡¨ç¤ºæ”¶åˆ°çš„ HTTP è¯·æ±‚æ•°ã€‚
let http_requests = Family::&lt;Labels, Counter&gt;::default();

// æ³¨å†ŒæŒ‡æ ‡
registry.register(
  "http_requests",
  "Number of HTTP requests received",
  http_requests.clone(),
);

// åœ¨æ‚¨çš„ä¸šåŠ¡é€»è¾‘ä¸­çš„æŸå¤„è®°å½•å•ä¸ª HTTP GET è¯·æ±‚ã€‚
http_requests.get_or_create(
    &amp;Labels { method: Method::GET, path: "/metrics".to_string() }
).inc();

// å½“åƒ Prometheus è¿™æ ·çš„ç›‘æ§ç³»ç»ŸæŠ“å–æœ¬åœ°èŠ‚ç‚¹æ—¶ï¼Œå°† registry ä¸­çš„æ‰€æœ‰æŒ‡æ ‡ä»¥æ–‡æœ¬æ ¼å¼ç¼–ç ï¼Œå¹¶å°†ç¼–ç åçš„æŒ‡æ ‡å‘å›ã€‚

let mut buffer = String::new();
encode(&amp;mut buffer, &amp;registry).unwrap();

let expected = "# HELP http_requests Number of HTTP requests received.\n".to_owned() +
               "# TYPE http_requests counter\n" +
               "http_requests_total{method=\"GET\",path=\"/metrics\"} 1\n" +
               "# EOF\n";
assert_eq!(expected, buffer);
</code></pre>
<ul>
<li><a href="https://github.com/prometheus/client_rust/tree/master/examples" rel="noopener noreferrer">æ›´å¤šä½¿ç”¨ç¤ºä¾‹</a></li>
</ul>
<h4>openai-hub å®‰å…¨é«˜æ•ˆçš„ OpenAI ç½‘å…³</h4>
<p>OpenAI Hub æ˜¯ä¸€ä¸ªå…¨é¢è€Œå¼ºå¤§çš„å·¥å…·ï¼Œæ—¨åœ¨ç®€åŒ–å’Œå¢å¼ºæ‚¨ä¸ OpenAI çš„ API çš„äº¤äº’ã€‚å®ƒé‡‡ç”¨åˆ›æ–°çš„æ–¹å¼æ¥å¹³è¡¡å¤šä¸ª API å¯†é’¥ï¼Œå…è®¸ç”¨æˆ·åœ¨ä¸éœ€è¦å•ç‹¬çš„ OpenAI API å¯†é’¥çš„æƒ…å†µä¸‹å‘å‡ºè¯·æ±‚ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜é‡‡ç”¨å…¨å±€è®¿é—®æ§åˆ¶åˆ—è¡¨ (ACL)ï¼Œä½¿æ‚¨èƒ½å¤Ÿæ§åˆ¶ç”¨æˆ·å¯ä»¥ä½¿ç”¨å“ªäº› API å’Œæ¨¡å‹ã€‚è¯¥é›†çº¿å™¨è¿˜åŒ…æ‹¬ç”¨äºå®‰å…¨å¯é çš„ç”¨æˆ·èº«ä»½éªŒè¯çš„ JWT èº«ä»½éªŒè¯ï¼Œç°åœ¨è¿˜åŒ…æ‹¬ç”¨äºè·Ÿè¸ª API ä½¿ç”¨æƒ…å†µå’Œä»¤ç‰Œæ¶ˆè€—çš„è®¿é—®æ—¥å¿—åŠŸèƒ½ã€‚</p>
<hr>
<p>ä¸»è¦ç‰¹å¾</p>
<ul>
<li>è´Ÿè½½å¹³è¡¡ï¼šæœ‰æ•ˆåˆ©ç”¨å¤šä¸ª API å¯†é’¥ï¼Œé˜²æ­¢è¿‡åº¦ä½¿ç”¨ä»»ä½•å•ä¸ªå¯†é’¥ã€‚</li>
<li>API å¯†é’¥ä¿æŠ¤ï¼šå…è®¸ç”¨æˆ·åœ¨ä¸éœ€è¦å•ç‹¬çš„ OpenAI API å¯†é’¥çš„æƒ…å†µä¸‹å‘å‡ºè¯·æ±‚ï¼Œä»è€Œå¢å¼ºå®‰å…¨æ€§å’Œæ˜“ç”¨æ€§ã€‚</li>
<li>å…¨å±€ ACLï¼šè§„èŒƒç”¨æˆ·å¯¹ç‰¹å®š API å’Œæ¨¡å‹çš„è®¿é—®ï¼Œç¡®ä¿åˆé€‚çš„äººå¯ä»¥è®¿é—®åˆé€‚çš„èµ„æºã€‚</li>
<li>JWT èº«ä»½éªŒè¯ï¼šä½¿ç”¨ JSON Web ä»¤ç‰Œ (JWT) çš„å®‰å…¨å¯é çš„ç”¨æˆ·èº«ä»½éªŒè¯ç³»ç»Ÿã€‚</li>
<li>è®¿é—®æ—¥å¿—ï¼šä½¿ç”¨æˆ‘ä»¬æ–°å®æ–½çš„è®¿é—®æ—¥å¿—åŠŸèƒ½è·Ÿè¸ª API ä½¿ç”¨æƒ…å†µå’Œä»¤ç‰Œæ¶ˆè€—ã€‚æ‚¨å¯ä»¥é€‰æ‹©å°†æ—¥å¿—å­˜å‚¨åœ¨æ–‡ä»¶ã€SQLiteã€MySQL æˆ– PostgreSQL åç«¯ã€‚</li>
</ul>
<hr>
<pre><code class="hljs bash">git clone https://github.com/lightsing/openai-hub.git
cd openai-hub

# build and run
cargo run run --bin openai-hubd --all-features --release
</code></pre>
<p>or</p>
<pre><code class="hljs nginx"># pull the Docker image
docker pull lightsing/openai-hub:latest

# run the Docker container
docker run -p 8080:8080 lightsing/openai-hub

# or with your custom configs
docker run -v /your/path/to/config:/opt/openai-hub/config -p &lt;yourport&gt; lightsing/openai-hub
</code></pre>
<ul>
<li>https://github.com/lightsing/openai-hub</li>
</ul>
<hr>
<p>From æ—¥æŠ¥å°ç»„ ä¾¯ç››é‘« mock</p>
<p>ç¤¾åŒºå­¦ä¹ äº¤æµå¹³å°è®¢é˜…ï¼š</p>
<ul>
<li><a href="https://rustcc.cn/" rel="noopener noreferrer">Rust.cc è®ºå›: æ”¯æŒ rss</a></li>
<li><a href="https://rustcc.cn/article?id=ed7c9379-d681-47cb-9532-0db97d883f62" rel="noopener noreferrer">å¾®ä¿¡å…¬ä¼—å·ï¼šRust è¯­è¨€ä¸­æ–‡ç¤¾åŒº</a></li>
</ul>

    </div>

    

    <div class="comments">
	<div class="">
	    <h3 class="left">è¯„è®ºåŒº</h3>
	    <a class="right new-comment" href="/p/comment/new?article_id=5f8142ce-06c4-4a69-a876-6b66c0370b5f">å†™è¯„è®º</a>
	    <div style="clear:both;"></div>
	</div>

	
	    <p class="useless">è¿˜æ²¡æœ‰è¯„è®º</p>
	
    </div>

    <div class="comment_paginator_part">
	<div class="comment_paginator right">
	    
	    <a href="/article?id=5f8142ce-06c4-4a69-a876-6b66c0370b5f&amp;current_page=1" class="current_page">
		1
	    </a>
	    
	    å…± 0 æ¡è¯„è®º, 1 é¡µ
	</div>
	<div style="clear:both;"></div>
    </div>
</div>

<script type="application/javascript">
    function hightlight($doms) {
	$doms.each(function (i, block) {
	    hljs.highlightBlock(block);
	});
    }

    hightlight($("pre code"));
</script>

</div>
<div id="footer">
    <div class="footer">
    <div class="site-desc">
	<p class="links">
		å‹æƒ…é“¾æ¥ï¼š
			<a target="_blank" href="http://tinylab.org/">æ³°æ™“ç§‘æŠ€</a>
			| <a target="_blank" href="https://ruby-china.org/">Ruby China</a>
			| <a target="_blank" href="https://eleduck.com/">ç”µé¸­è¿œç¨‹ç¤¾åŒº</a>
			| <a target="_blank" href="http://ipfs.cn/">IPFSä¸­æ–‡ç¤¾åŒº</a>
	</p>
	<p class="links">
	    <a href="/acknowledgement">é¸£è°¢ï¼š</a>
	    <a href="/acknowledgement">è¿…è¾¾äº‘</a>
	    <a href="/acknowledgement">èµ›è´</a>
	    <a href="/acknowledgement">LongHash</a>
	</p>
	    <p> Â©2016~2020 Rust.cc ç‰ˆæƒæ‰€æœ‰ &nbsp;&nbsp;
	    <span class="powered">Powered by
		<a href="https://github.com/daogangtang/forustm">Forustm</a> &amp;
		<a href="https://github.com/daogangtang/rusoda">Rusoda</a> &amp;
		<a href="https://github.com/sappworks/sapper">Sapper</a>
	    </span>
	</p>
		<p>
        <span><a href="https://beian.miit.gov.cn">èœ€ICPå¤‡20010673å·-1</a></span>
		</p>

    </div>
</div>

<script>
var _hmt = _hmt || [];
(function() {
 var hm = document.createElement("script");
 hm.src = "https://hm.baidu.com/hm.js?1fd834970f3ad2bab2cb57d4aa2b2e5a";
 var s = document.getElementsByTagName("script")[0]; 
 s.parentNode.insertBefore(hm, s);
 })();
</script>

</div>




</body></html>